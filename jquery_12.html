<!--
-------------------------------------
jquery_12_AJAX_chcekLogin.html
--------------------------------------
	=> 입력한 아이디,암호를 가지고 비동기 방식으로 서버와 통신하여
	아이디,암호의 존재 여부를 확인해본다.
-->

<html>	
<meta charset="Utf-8">
<head>
	<script src="jquery-1.11.0.min.js"></script>
	<script src="../JavaScript/common_js.js"></script>
	<script>
		//--------------------------------
		// 로그인 버튼을 클릭하면 호출되는 함수 선언하기
		// 함수 안에서 아이디,암호 유효성을 체크하고
		// 비동기방식으로 웹서버로 아이디,암호를 전송하고
		// 웹서버로부터 아이디,암호의 존재 여부의 응답을 받을 것이다. 
		//--------------------------------
		function checkLogin()  {
			//--------------------------
			// 입력한 아이디를 얻어 변수에 저장
			//--------------------------
			var uid = $(".uid").val();
			//---------------------------------------
			// 위 코드는 아래 코드로 대체가 가능하다.
			// 	var uid = document.loginForm.uid.value;
			//------------------------------------------
			// 만약에 아이디가 비어있으면 경고하고 비우고 커서 들여놓고 함수중단
				if( uid.split(" ").join("")==""  ) {
					alert("아이디입력 요망");
					 $(".uid").val("");
					  $(".uid").focus("");
					return;
				}
				//----------------------------------
				// 입력한 암호를 얻어 변수에 저장
				//----------------------------------
				var pwd = $(".pwd").val();
				// 만약에 암호가 비어 있으면 경고하고, 비우고 커서 들여놓고 함수중단
				if( pwd.split(" ").join("")==""  ) {
					alert("암호 입력 요망");
					 $(".pwd").val("");
					  $(".pwd").focus("");
					return;
				}
				alert( $( "form").filter("[name=loginForm]").serialize()    );
				//---------------------------
				// 비동기 방식으로 웹서버의 자원을 호출 한 후
				// 아이디,암호의 존재여부를 html 로 응답받는다.
				// 응답받은 html 안에 아이디,암호의 존재여부가 들어있다.
				//-----------------------------
				 $.ajax( 
				{ 	
					//-------------------------
					//서버쪽 호출 URL 주소 설정   
					// 원래는 서버쪽 자원을 호출하여야 하나 웹서버 구축이 안됐으므로 html 호출로대처한다.
					//-------------------------
					 url : "checkLogin.html"
				 	//-------------------------
					//form 태그 안의 입력양식의 name값과 value 값을 서버로 보내는 방법 설정
					//-------------------------
					 ,type : "post"
				 	//-------------------------
					//웹서버로 보낼 form태그 안의 입력양식의 name값과 value 값을 설정
					//-------------------------
					//,data : {'입력양식 name값':입력양식value값 ,'입력양식 name값':입력양식value값, ~}
					 ,data : {'uid':uid,'pwd':pwd }
								//--------------------------
								// 위 코딩 대신에 아래 코딩으로 대체가 가능하다.
								//---------------------------
								// , data :"uid="+uid+"&pwd="+pwd
								//--------------------------
								// 위 코딩 대신에 form 태그 내부의 모든 name값과 value 값을 보내는 방법이 아래와 같다.
								//---------------------------
								// , date :$ ("form").filter("[name=loginForm]").serialize();
				 	//-------------------------
					//웹서버가 응답을 성공적으로 보냈을 경우 실행할 익명함수 설정
					// 익명함수의 매개변수에는 서버의 응답물이 저장된 HTML 소스가 들어옴.
					//-------------------------
					,success : function( responseHTML )  {
						//----------------------------------------------------------------
						//매개변수로 들어온 서버의 응답물 HTML 문자열을 관리하는 JQuery 객체의 메위주 얻기
						//----------------------------------------------------------------
						// alert( responseHTML  );
						var obj = $(responseHTML);
						//----------------------------------------------------------------
						// JQuery 객체가 관리하는 웹서버의 웹서버의 응답물 HTML 문자열에서  class=idCnt 를 가진
						// 태그가 안고 있는 문자열을 얻기. 이 문자열이 바로 아이디,암호의 존재 개수이다.
						//----------------------------------------------------------------
						var idCnt = obj.filter(".idCnt").text();
						//----------------------------------------------------------------
						// 문자열의 앞뒤 공백 제거하기
						//----------------------------------------------------------------
						idCnt =$.trim(idCnt);
						//----------------------------------------------------------------
						// 만약 문자열이 1이면 로그인 성공 메시지 띄우고 main.html 로 이동하기
						//----------------------------------------------------------------
						//alert(idCnt)
						if(idCnt==1) {
							alert("로그인성공")
							location.replace("main.html");
						}
						//----------------------------------------------------------------
						// 만약 문자열이 1이 아니면 경고하고 아이디,암호 비우기
						//----------------------------------------------------------------
						else{
							alert("로그인실패! 아이디 암호 재 입력 바람")
							 $(".uid").val("");
							$(".pwd").val("");
						}
					}
				 	//-------------------------
					//웹서버와 통신이 실패했을 경우 실행할 익명함수 설정.
					//-------------------------
					,error : function(){  
						alert("웹서버와 통신 과정에서 에러발생! 관리자에게문의바람");
					}

				}
			);
		}
		</script>
 </head>

 <body>
   <form name="loginForm" action=''>
   [회원가입]
   <table border=1 cellpadding="5">
	<tr>
		<td>아이디</td>
		<td><input type="text" class="uid" name="uid">
	</tr>
	<tr>
		<td>암호</td>
		<td><input type="password" class="pwd" name="pwd">
	</tr>
   </table><br>
   <input type="button" value="로그인" onclick="checkLogin();">
   </form>
 </body>
</html>
